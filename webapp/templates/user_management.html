{% extends "base.html" %}

{% block title %}User Management - ProxyFarm{% endblock %}

{% block page_title %}User Management{% endblock %}
{% block page_subtitle %}Manage proxy users, credentials, and access permissions{% endblock %}

{% block header_actions %}
<button class="btn btn-primary" onclick="openModal('addUserModal')">
    <i class="fas fa-user-plus"></i>
    Add User
</button>
{% endblock %}

{% block content %}
<!-- User Stats -->
<div class="user-stats">
    <div class="user-stat">
        <div class="user-stat-value">15</div>
        <div class="user-stat-label">Total Users</div>
    </div>
    <div class="user-stat">
        <div class="user-stat-value">12</div>
        <div class="user-stat-label">Active Users</div>
    </div>
    <div class="user-stat">
        <div class="user-stat-value">3</div>
        <div class="user-stat-label">Premium Users</div>
    </div>
    <div class="user-stat">
        <div class="user-stat-value">47</div>
        <div class="user-stat-label">Active Connections</div>
    </div>
</div>

<!-- User Grid -->
<div class="user-grid">
    <!-- User Card 1 -->
    <div class="user-card">
        <div class="user-card-header">
            <div class="user-info">
                <div class="user-avatar">A</div>
                <div class="user-details">
                    <h3>admin</h3>
                    <p>Administrator</p>
                </div>
            </div>
            <div class="user-status">
                <div class="status-dot online"></div>
                <span>Online</span>
            </div>
        </div>
        <div class="user-card-body">
            <div class="user-detail">
                <span class="user-detail-label">Password:</span>
                <span class="user-detail-value">admin123</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Assigned Port:</span>
                <span class="user-detail-value">3330</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Type:</span>
                <span class="status-badge premium">Premium</span>
            </div>
            <div class="proxy-config">
                <div class="proxy-config-header">HTTP Proxy Config:</div>
                <div class="proxy-config-value">188.215.229.236:3330:admin:admin123</div>
            </div>
        </div>
        <div class="user-card-footer">
            <button class="action-btn" title="Edit User">
                <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn" title="View Config">
                <i class="fas fa-code"></i>
            </button>
            <button class="action-btn" title="Reset Password">
                <i class="fas fa-key"></i>
            </button>
            <button class="action-btn danger" title="Delete User">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>

    <!-- User Card 2 -->
    <div class="user-card">
        <div class="user-card-header">
            <div class="user-info">
                <div class="user-avatar">U1</div>
                <div class="user-details">
                    <h3>user1</h3>
                    <p>Standard User</p>
                </div>
            </div>
            <div class="user-status">
                <div class="status-dot online"></div>
                <span>Online</span>
            </div>
        </div>
        <div class="user-card-body">
            <div class="user-detail">
                <span class="user-detail-label">Password:</span>
                <span class="user-detail-value">pass123</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Assigned Port:</span>
                <span class="user-detail-value">3331</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Type:</span>
                <span class="status-badge active">Standard</span>
            </div>
            <div class="proxy-config">
                <div class="proxy-config-header">HTTP Proxy Config:</div>
                <div class="proxy-config-value">188.215.229.236:3331:user1:pass123</div>
            </div>
        </div>
        <div class="user-card-footer">
            <button class="action-btn" title="Edit User">
                <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn" title="View Config">
                <i class="fas fa-code"></i>
            </button>
            <button class="action-btn" title="Reset Password">
                <i class="fas fa-key"></i>
            </button>
            <button class="action-btn danger" title="Delete User">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>

    <!-- User Card 3 -->
    <div class="user-card">
        <div class="user-card-header">
            <div class="user-info">
                <div class="user-avatar">U2</div>
                <div class="user-details">
                    <h3>user2</h3>
                    <p>Standard User</p>
                </div>
            </div>
            <div class="user-status">
                <div class="status-dot offline"></div>
                <span>Offline</span>
            </div>
        </div>
        <div class="user-card-body">
            <div class="user-detail">
                <span class="user-detail-label">Password:</span>
                <span class="user-detail-value">pass456</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Assigned Port:</span>
                <span class="user-detail-value">3332</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Type:</span>
                <span class="status-badge active">Standard</span>
            </div>
            <div class="proxy-config">
                <div class="proxy-config-header">HTTP Proxy Config:</div>
                <div class="proxy-config-value">188.215.229.236:3332:user2:pass456</div>
            </div>
        </div>
        <div class="user-card-footer">
            <button class="action-btn" title="Edit User">
                <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn" title="View Config">
                <i class="fas fa-code"></i>
            </button>
            <button class="action-btn" title="Reset Password">
                <i class="fas fa-key"></i>
            </button>
            <button class="action-btn danger" title="Delete User">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>

    <!-- User Card 4 -->
    <div class="user-card">
        <div class="user-card-header">
            <div class="user-info">
                <div class="user-avatar">T1</div>
                <div class="user-details">
                    <h3>test1</h3>
                    <p>Test User</p>
                </div>
            </div>
            <div class="user-status">
                <div class="status-dot online"></div>
                <span>Online</span>
            </div>
        </div>
        <div class="user-card-body">
            <div class="user-detail">
                <span class="user-detail-label">Password:</span>
                <span class="user-detail-value">test123</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Assigned Port:</span>
                <span class="user-detail-value">3338</span>
            </div>
            <div class="user-detail">
                <span class="user-detail-label">Type:</span>
                <span class="status-badge inactive">Testing</span>
            </div>
            <div class="proxy-config">
                <div class="proxy-config-header">HTTP Proxy Config (No Auth):</div>
                <div class="proxy-config-value">188.215.229.236:3338</div>
            </div>
        </div>
        <div class="user-card-footer">
            <button class="action-btn" title="Edit User">
                <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn" title="View Config">
                <i class="fas fa-code"></i>
            </button>
            <button class="action-btn" title="Reset Password">
                <i class="fas fa-key"></i>
            </button>
            <button class="action-btn danger" title="Delete User">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div id="addUserModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Add New User</h2>
            <button class="close" onclick="closeModal('addUserModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="addUserForm">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" required>
                </div>
                <div class="form-group">
                    <label class="form-label">User Type</label>
                    <select class="form-select" id="userType">
                        <option value="standard">Standard</option>
                        <option value="premium">Premium</option>
                        <option value="testing">Testing</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Assigned Port</label>
                    <select class="form-select" id="assignedPort">
                        <option value="3330">3330 (Multi-Protocol)</option>
                        <option value="3331">3331 (HTTP)</option>
                        <option value="3332">3332 (HTTP)</option>
                        <option value="3333">3333 (HTTP)</option>
                        <option value="3334">3334 (HTTP)</option>
                        <option value="3335">3335 (SOCKS5)</option>
                        <option value="3336">3336 (SOCKS5)</option>
                        <option value="3337">3337 (SOCKS5)</option>
                        <option value="3338">3338 (HTTP - No Auth)</option>
                        <option value="3339">3339 (SOCKS5 - No Auth)</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('addUserModal')">Cancel</button>
            <button class="btn btn-primary" onclick="addUser()">Add User</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function openModal(modalId) {
    document.getElementById(modalId).style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function addUser() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const userType = document.getElementById('userType').value;
    const assignedPort = document.getElementById('assignedPort').value;

    if (!username || !password) {
        alert('Please fill in all required fields');
        return;
    }

    // Simulate adding user
    alert(`User "${username}" added successfully with port ${assignedPort}`);
    closeModal('addUserModal');
    
    // Reset form
    document.getElementById('addUserForm').reset();
}

// Copy config to clipboard
function copyConfig(config) {
    navigator.clipboard.writeText(config).then(() => {
        alert('Configuration copied to clipboard!');
    });
}

// Simulate user status updates
setInterval(() => {
    const statusDots = document.querySelectorAll('.status-dot');
    statusDots.forEach(dot => {
        if (Math.random() > 0.9) {
            dot.classList.toggle('online');
            dot.classList.toggle('offline');
            
            const statusText = dot.closest('.user-status').querySelector('span');
            statusText.textContent = dot.classList.contains('online') ? 'Online' : 'Offline';
        }
    });
}, 10000);

// Click handlers for proxy config copying
document.querySelectorAll('.proxy-config-value').forEach(config => {
    config.addEventListener('click', function() {
        copyConfig(this.textContent);
    });
    config.style.cursor = 'pointer';
    config.title = 'Click to copy';
});

// Modal close on outside click
window.onclick = function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
}
</script>
{% endblock %}